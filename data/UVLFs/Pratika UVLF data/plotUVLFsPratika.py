
import numpy as np

import matplotlib.pyplot as plt
import matplotlib.cm as cm


def Schechter_LF_mag(M, phi0, M0, alpha):
    return 0.4*np.log(10)*phi0*np.exp(-10**(-0.4*(M-M0)))*10**(-0.4*(alpha+1)*(M-M0));


LFgrid = {4 : 
[[-22.69, 0.000003, 0.000004],
[-22.19, 0.000015, 0.000009],
[-21.69, 0.000134, 0.000023],
[-21.19, 0.000393, 0.000040],
[-20.69, 0.000678, 0.000063],
[-20.19, 0.001696, 0.000113],
[-19.69, 0.002475, 0.000185],
[-19.19, 0.002984, 0.000255],
[-18.69, 0.005352, 0.000446],
[-18.19, 0.006865, 0.001043],
[-17.69, 0.010473, 0.002229],
[-16.94, 0.024580, 0.003500],
[-15.94, 0.025080, 0.007860]]
, 5:
[[-23.11, 0.000002, 0.000002],
[-22.61, 0.000006, 0.000003],
[-22.11, 0.000034, 0.000008],
[-21.61, 0.000101, 0.000014],
[-21.11, 0.000265, 0.000025],
[-20.61, 0.000676, 0.000046],
[-20.11, 0.001029, 0.000067],
[-19.61, 0.001329, 0.000094],
[-19.11, 0.002085, 0.000171],
[-18.36, 0.004460, 0.000540],
[-17.36, 0.008600, 0.001760],
[-16.36, 0.024400, 0.007160]] 
, 6 :
[[-22.52, 0.000002, 0.000002],
[-22.02, 0.000015, 0.000006],
[-21.52, 0.000053, 0.000012],
[-21.02, 0.000176, 0.000025],
[-20.52, 0.000320, 0.000041],
[-20.02, 0.000698, 0.000083],
[-19.52, 0.001246, 0.000137],
[-18.77, 0.001900, 0.000320],
[-17.77, 0.006680, 0.001380],
[-16.77, 0.013640, 0.004200]]
, 7 :
[[-22.66, 0.000002, -1],
[-21.66, 0.000033, 0.000009],
[-21.16, 0.000048, 0.000015],
[-20.66, 0.000193, 0.000034],
[-20.16, 0.000309, 0.000061],
[-19.66, 0.000654, 0.000100],
[-19.16, 0.000907, 0.000177],
[-18.66, 0.001717, 0.000478],
[-17.91, 0.005840, 0.001460],
[-16.91, 0.008500, 0.002940]]
, 8:
[[-22.87, 0.000002, -1],
[-22.37, 0.000002, -1],
[-21.87, 0.000005, 0.000003],
[-21.37, 0.000013, 0.000005],
[-20.87, 0.000058, 0.000015],
[-20.37, 0.000060, 0.000026],
[-19.87, 0.000331, 0.000104],
[-19.37, 0.000533, 0.000226],
[-18.62, 0.001060, 0.000340],
[-17.62, 0.002740, 0.001040]]
, 3:
[[-22.77, 0.003e-3, 0.001e-3],
[-22.27, 0.030e-3, 0.013e-3],
[-21.77, 0.085e-3, 0.032e-3],
[-21.27, 0.240e-3, 0.104e-3],
[-20.77, 0.686e-3, 0.249e-3],
[-20.27, 1.530e-3, 0.273e-3],
[-19.77, 2.934e-3, 0.333e-3],
[-19.27, 4.296e-3, 0.432e-3],
[-18.77, 5.536e-3, 0.601e-3]]
, 2.3:
[[-22.58, 0.004e-3, 0.003e-3],
[-22.08, 0.035e-3, 0.007e-3],
[-21.58, 0.142e-3, 0.016e-3],
[-21.08, 0.341e-3, 0.058e-3],
[-20.58, 1.246e-3, 0.083e-3],
[-20.08, 2.030e-3, 0.196e-3],
[-19.58, 3.583e-3, 0.319e-3],
[-19.08, 7.171e-3, 0.552e-3],
[-18.58, 8.188e-3, 0.777e-3],
[-18.08, 12.62e-3, 1.778e-3]],
0.05 :
[[-19.899, 5.083e-06, 4.458e-06],
[-19.546, 7.774e-05, 2.430e-05],
[-18.991, 2.738e-04, 3.911e-05],
[-18.511, 7.037e-04, 6.384e-05],
[-18.032, 1.587e-03, 1.250e-04],
[-17.552, 2.544e-03, 1.647e-04],
[-17.098, 2.977e-03, 2.345e-04],
[-16.517, 2.900e-03, 3.715e-04],
[-16.013, 5.164e-03, 6.791e-04],
[-15.558, 6.369e-03, 1.006e-03],
[-15.079, 7.653e-03, 1.654e-03],
[-14.625, 6.539e-03, 2.439e-03],
[-13.994, 9.195e-03, 3.815e-03],
[-13.539, 8.499e-03, 5.071e-03],
[-13.060, 1.327e-02, 8.756e-03],
[-12.025, 4.674e-02, 3.424e-02]],
0.5:
[[-20.323, 3.006e-04, 1.357e-04],
[-20.167, 4.055e-05, 3.872e-05],
[-19.702, 4.721e-04, 1.383e-04],
[-19.295, 4.677e-04, 1.584e-04],
[-18.986, 1.230e-03, 3.447e-04],
[-18.573, 1.770e-03, 4.275e-04],
[-18.249, 2.153e-03, 6.172e-04],
[-17.843, 2.992e-03, 6.784e-04],
[-17.476, 2.944e-03, 8.549e-04],
[-17.180, 4.634e-03, 1.421e-03]],
1.25:
[[-21.06,   0.033e-03,	0.027e-03,	0.074e-03],
[-20.56,	0.196e-03,	0.077e-03,	0.116e-03],
[-20.06,	0.490e-03,	0.124e-03,	0.160e-03],
[-19.56,	0.786e-03,	0.158e-03,	0.193e-03],
[-19.06,	1.725e-03,	0.235e-03,	0.269e-03],
[-18.56,	3.007e-03,	0.311e-03,	0.344e-03],
[-18.06,	4.557e-03,	0.383e-03,	0.416e-03]],
1.5:
[[-21.09,	0.037e-03,	0.030e-03,	0.084e-03],
[-20.59,	0.220e-03,	0.087e-03,	0.131e-03],
[-20.09,	0.559e-03,	0.147e-03,	0.193e-03],
[-19.59,	0.960e-03,	0.213e-03,	0.266e-03],
[-19.09,	1.811e-03,	0.422e-03,	0.535e-03]],
10:
[[-21.25,   0.0095e-4, 0.0079e-4,  0.022e-4],
[-20.25,   0.098e-4,  0.053e-4,   0.095e-4],
[-19.25,   0.34e-4,   0.22e-4, 0.45e-4],
[-18.25,   1.9e-4,   1.2e-4, 2.5e-4],
[-17.25,   6.3e-4,   5.2e-4, 14.9e-4]]
}

#dictionary of LF parameters (phi*, M*, alpha)
LFpars = {
0.05:[10**-2.37, -18.04, -1.22],    #Wyder+05: https://ui.adsabs.harvard.edu/abs/2005ApJ...619L..15W/abstract
0.5 : [1.69e-3, -19.49, -1.55],   # Arnouts+05:
1.25: [10**-2.9, -20.08, -1.84],  # Oesch+10: https://ui.adsabs.harvard.edu/abs/2010ApJ...725L.150O/abstract
1.5:  [10**-2.64, -19.82, -1.46], # Oesch+10
2.3: [2.75e-3, -20.70, -1.73], #Reddy&Steidel 09, https://ui.adsabs.harvard.edu/abs/2009ApJ...692..778R/abstract
3:   [1.71e-3, -20.97, -1.73], #Reddy&Steidel 09
4:   [1.97e-3, -20.88, -1.64], #Bouwens+15: https://ui.adsabs.harvard.edu/abs/2015ApJ...803...34B/abstract
5:   [0.74e-3, -21.17, -1.76], #Bouwens+15
6:   [0.50e-3, -20.94, -1.87], #Bouwens+15
7:   [0.29e-3, -20.87, -2.06], #Bouwens+15
8:   [0.21e-3, -20.63, -2.02], #Bouwens+15
10:  [10**-4.89, -20.6, -2.28], # Oesch+18, https://ui.adsabs.harvard.edu/abs/2018ApJ...855..105O/abstract
}


##
colors = cm.RdYlBu_r(np.linspace(0, 1, 12))

fig = plt.figure( figsize=(7,7.5) )
ax1 = fig.add_subplot(211)
ax2 = fig.add_subplot(212)

  
for zi,z in enumerate([0.05,0.5,1.25,1.5,2.3,3,4,5,6,7,8,10]):
    tab = np.array(LFgrid[z])
    Muv = tab[:,0]
    LFp = tab[:,1]
    LFe = tab[:,2]

    if z<3:
        ax=ax1
    else:
        ax=ax2

    if len(tab[0,:])==4: # i.e. have different lower and upper errorbars
        LFeh = tab[:,3]

        ii = LFe > 0
        ax.errorbar(Muv[ii], LFp[ii], yerr=[LFe[ii],LFeh[ii]], fmt='o', label='z~%g' % (z),
                    color=colors[zi], linewidth=1.0, mec=[0.6,0.6,0.6], markeredgewidth=0.75)
    else:
        ii = LFe>0
        ax.errorbar(Muv[ii],LFp[ii],LFe[ii],fmt='o', label='z~%g'%(z),
                    color=colors[zi],linewidth=1.0, mec=[0.6,0.6,0.6], markeredgewidth=0.75)

    # also plot Schechter Fits
    pars = LFpars[z]
    MM = np.linspace(np.amin(Muv)-0.2,np.amax(Muv)+0.2,100)
    LF = Schechter_LF_mag(MM, pars[0], pars[1], pars[2])
    ax.plot(MM,LF,'-', label=None, color=colors[zi], linewidth=2.0)


                
    ax.set_yscale("log")

    ax.set_xlabel(r'M$_{UV}$')
    ax.set_ylabel(r'$\phi$ [Mpc$^{-3}$mag$^{-1}$]')

    ax.set_xlim([-23,-16])
    ax.set_ylim([1e-6,1e-1])



    leg = ax.legend(loc=0,handletextpad=0.1)
    for label in leg.get_texts():
        label.set_fontsize(9)  # the font size
    for label in leg.get_lines():
        label.set_linewidth(2)   # the legend line width




    
if 1:
    plotName = 'LFplot.pdf'
    fig.tight_layout(pad=0.2)
    print("Plotting to ", plotName)
    fig.savefig(plotName, dpi=fig.dpi*5)

    
plt.show()    
    
    
        
    

  
